<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Powerlifting App</title>
<style>
  body { font-family: Arial, sans-serif; margin: 10px; }
  table { border-collapse: collapse; margin-bottom: 20px; width: 100%; }
  th, td { border: 1px solid #000; padding: 5px; text-align: center; white-space: nowrap; }
  input { width: 80px; font-size: 1em; padding: 5px; text-transform: uppercase; }
  button { font-size: 1em; padding: 5px 10px; margin-bottom: 10px; }

  /* Tabelle scrollabili su mobile */
  .table-container { overflow-x: auto; }

  .migliore { background-color: #c8e6c9; }
  .peggiore { background-color: #ffcdd2; }
</style>
</head>
<body>

<h1>Powerlifting App</h1>
<div id="inizio">Premi <button onclick="aggiungiAtleta()">+ Aggiungi Atleta</button> per aggiungere un atleta</div>

<div class="table-container">
  <table id="powerliftingTable">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Peso</th>
        <th>Squat1</th>
        <th>Squat2</th>
        <th>Squat3</th>
        <th>Best Squat</th>
        <th>Panca1</th>
        <th>Panca2</th>
        <th>Panca3</th>
        <th>Best Panca</th>
        <th>Stacco1</th>
        <th>Stacco2</th>
        <th>Stacco3</th>
        <th>Best Stacco</th>
        <th>Totale</th>
        <th>Delta Max</th>
        <th>Delta Min</th>
        <th>Entrata per superare</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<h2>Classifica</h2>
<div class="table-container">
  <table id="classificaTable">
    <thead>
      <tr>
        <th>Posizione</th>
        <th>Nome</th>
        <th>Peso</th>
        <th>Totale</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<h2>Legenda</h2>
<table>
  <tr><td>Best Squat / Panca / Stacco</td><td>Il migliore dei tre tentativi</td></tr>
  <tr><td>Totale</td><td>Somma dei tre migliori esercizi</td></tr>
  <tr><td>Delta Max</td><td>Quanto sei sotto il totale massimo</td></tr>
  <tr><td>Delta Min</td><td>Quanto sei sopra il totale minimo</td></tr>
  <tr><td>Entrata per superare</td><td>Peso da sollevare nello Stacco per superare i due atleti più vicini</td></tr>
</table>

<script>
function aggiungiAtleta() {
    const tbody = document.querySelector('#powerliftingTable tbody');
    const row = document.createElement('tr');
    row.innerHTML = `
        <td><input type="text" placeholder="Nome"></td>
        <td><input type="number" step="0.1" class="peso"></td>
        <td><input type="number" class="squat"></td>
        <td><input type="number" class="squat"></td>
        <td><input type="number" class="squat"></td>
        <td class="best-squat"></td>
        <td><input type="number" class="panca"></td>
        <td><input type="number" class="panca"></td>
        <td><input type="number" class="panca"></td>
        <td class="best-panca"></td>
        <td><input type="number" class="stacco"></td>
        <td><input type="number" class="stacco"></td>
        <td><input type="number" class="stacco"></td>
        <td class="best-stacco"></td>
        <td class="totale"></td>
        <td class="delta-max"></td>
        <td class="delta-min"></td>
        <td class="entrata-superiore"></td>
    `;
    tbody.appendChild(row);

    const nomeInput = row.querySelector('input[type="text"]');
    nomeInput.addEventListener('input', () => {
        nomeInput.value = nomeInput.value.toUpperCase();
        calcolaTotali();
    });

    row.querySelectorAll('input:not([type="text"])').forEach(input => {
        input.addEventListener('input', () => {
            if (input.value < 0) input.value = 0;
            if (input.value > 1000) input.value = 1000;
            calcolaTotali();
        });
    });
}

function calcolaTotali() {
    const tbody = document.querySelector('#powerliftingTable tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));

    const totaliAtleti = rows.map(row => {
        const nome = row.querySelector('input[type="text"]').value || '';
        const peso = parseFloat(row.querySelector('.peso').value) || 0;

        const squatVals = Array.from(row.querySelectorAll('.squat')).map(i => parseFloat(i.value)).filter(v => !isNaN(v));
        const bestSquat = squatVals.length ? Math.max(...squatVals) : '';
        row.querySelector('.best-squat').textContent = bestSquat;

        const pancaVals = Array.from(row.querySelectorAll('.panca')).map(i => parseFloat(i.value)).filter(v => !isNaN(v));
        const bestPanca = pancaVals.length ? Math.max(...pancaVals) : '';
        row.querySelector('.best-panca').textContent = bestPanca;

        const staccoVals = Array.from(row.querySelectorAll('.stacco')).map(i => parseFloat(i.value)).filter(v => !isNaN(v));
        const bestStacco = staccoVals.length ? Math.max(...staccoVals) : '';
        row.querySelector('.best-stacco').textContent = bestStacco;

        const totale = (bestSquat || 0) + (bestPanca || 0) + (bestStacco || 0);
        row.querySelector('.totale').textContent = totale || '';
        row.querySelector('.totale').classList.remove('migliore', 'peggiore');

        return { nome, totale, peso, row, bestStacco };
    });

    if (totaliAtleti.length) {
        const maxTotale = Math.max(...totaliAtleti.map(a => a.totale));
        const minTotale = Math.min(...totaliAtleti.map(a => a.totale));

        totaliAtleti.forEach(a => {
            if (a.totale === maxTotale) a.row.querySelector('.totale').classList.add('migliore');
            if (a.totale === minTotale) a.row.querySelector('.totale').classList.add('peggiore');

            a.row.querySelector('.delta-max').textContent = a.totale ? maxTotale - a.totale : '';
            a.row.querySelector('.delta-min').textContent = a.totale ? a.totale - minTotale : '';

            const superiori = totaliAtleti.filter(b => b.totale > a.totale).slice(0, 2);
            if (superiori.length > 0) {
                let entrataTesto = superiori.map(s => {
                    const targetTotale = s.totale + 0.5;
                    const staccoNecessario = (a.bestStacco || 0) + (targetTotale - a.totale);
                    return `Per superare ${s.nome} (${s.totale.toFixed(1)}): Stacco ≥ ${staccoNecessario.toFixed(1)} → Totale ${targetTotale.toFixed(1)}`;
                }).join('<br>');
                a.row.querySelector('.entrata-superiore').innerHTML = entrataTesto;
            } else {
                a.row.querySelector('.entrata-superiore').textContent = '-';
            }
        });

        // Aggiorna classifica ordinata
        const classificaBody = document.querySelector('#classificaTable tbody');
        classificaBody.innerHTML = '';
        totaliAtleti
            .slice()
            .sort((a,b) => b.totale - a.totale || a.peso - b.peso)
            .forEach((a, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${a.nome}</td>
                    <td>${a.peso}</td>
                    <td class="${a.totale === maxTotale ? 'migliore' : a.totale === minTotale ? 'peggiore' : ''}">${a.totale || ''}</td>
                `;
                classificaBody.appendChild(tr);
            });
    }
}
</script>

</body>
</html>
